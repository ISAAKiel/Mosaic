---
title       : Cultural & Geographic Distance
subtitle    : Modelling Spheres of Intercation
author      : Oliver Nakoinz, Daniel Knitter
job         : MOSAIC Summer School 2016
framework   : io2012        # {io2012, html5slides, shower, dzslides, ...}
highlighter : highlight.js  # {highlight.js, prettify, highlight}
hitheme     : tomorrow    # 
widgets     : [mathjax]            # {mathjax, quiz, bootstrap}
mode        : selfcontained # {standalone, draft}
knit        : slidify::knit2slides
logo        : logo03.png
biglogo     : logo03.png
---  

<style type="text/css">
body {background:grey transparent;
}
</style>

<style>
strong {
  font-weight: bold;
}
</style>

## Cultural & Geographic Distance

- Cultural Distance
  - Theory
  - Practice
  - Distance diagramms

- Geographic Distance
  - Geographic Space
  - Calculating Distance 

<div style='position:absolute;bottom:20%;right:5%'>
    <img  height="200" width="200" src='assets/img/logo03.png' />
</div>

<a class="btn btn-primary btn-large" href='https://isaakiel.github.io/index.html'>
 <img  height="100" width="100" style='position:absolute;top:5%;right:5%' src='assets/img/ISAAK.png' />
</a>

---

## Cultural Distances

- Introduction
- Cultural distances: Theory
- Cultural distances: Practice
- Distance diagramms: Theory
- Distance diagramms: Practice


<div style='position:absolute;bottom:20%;right:5%'>
    <img  height="200" width="200" src='assets/img/logo03.png' />
</div>

<a class="btn btn-primary btn-large" href='https://isaakiel.github.io/index.html'>
 <img  height="100" width="100" style='position:absolute;top:5%;right:5%' src='assets/img/ISAAK.png' />
</a>

--- .segue bg:grey

## Cultural distances

<a class="btn btn-primary btn-large" href='https://isaakiel.github.io/index.html'>
 <img  height="100" width="100" style='position:absolute;top:5%;right:5%' src='assets/img/ISAAK.png' />
</a>

--- &twocol 

## Cultural distances

*** =left

**Imports vs cultural distances**

- connectinga site to a provenience region
- individual interactions can be traced

<div style='position:absolute;bottom:20%;left:15%'>
    <img  height="200" width="200" src='assets/img/pic01.png' />
</div>

*** =right

**Cultural distance**

- interactions are producing cultural similarities
- difference in material culture
- statistical level of interaction between sites or regions

<div style='position:absolute;bottom:15%;right:10%'>
    <img  height="200" width="450" src='assets/img/pic02.png' />
</div>

---

## Cultural distances

**traditional „Culture“ in Archaeology**

Archaeological culture = spatial and temporal limited entity of material culture 

**Cultures can correspond with:**

- language
- people
- race
- collective identity
- more...

<div style='position:absolute;top:35%;right:30%'>
    <img  height="250" width="200" src='assets/img/pic03.png' />
</div>

<div style='position:absolute;top:35%;right:5%'>
    <img  height="250" width="200" src='assets/img/pic04.png' />
</div>

<div style='position:absolute;bottom:10%;right:50%'>
    <img  height="200" width="200" src='assets/img/pic05.png' />
</div>

--- &twocol

## Cultural distances | Components of cultural theory

*** =left

- What is culture?
  - Hansen, Tylor
- Why using culture?
  - B. Malinowski, A. Schweitzer
- How does culture work?
  - T. Parsons, A. Kroeber, R.Dawkins
- How are cultures connected?
  - F. Steger
- How do cultures evolve?
  - O. Spengler, R. Redfield, R. Linton u. M. Herskovits


*** =right

- Which components have cultures?
  - J. Huxley

<div style='position:absolute;top:35%;right:30%'>
    <img  height="200" width="150" src='assets/img/pic06.png' />
</div>

<div style='position:absolute;top:35%;right:5%'>
    <img  height="200" width="250" src='assets/img/pic07.png' />
</div>

<div style='position:absolute;bottom:7%;right:25%'>
    <img  height="200" width="150" src='assets/img/pic08.png' />
</div>

--- .segue bg:grey

## What is wrong with the traditional approaches?

--- &twocol

## Cultural distances | Culture

*** =left

```{r collapse=TRUE, eval=FALSE}
Culture covers standardisations which 
are valid in collectives. 

(Hansen 2003, 39)
```

<div style='position:absolute;top:45%;left:5%'>
    <img  height="200" width="550" src='assets/img/pic09.png' />
</div>

*** =right

- Formal and abstract definition which covers most other
- Spatial archaeological cultures as special case
- Applicable in archaeology

<div style='position:absolute;bottom:5%;right:5%'>
    <img  height="200" width="550" src='assets/img/pic10.png' />
</div>

--- 

## Cultural distances

Structures|**Traditional arch. culture**|**Current arch. culture**
----|----|----
Actors|historical actor|cultures can not act
Dimensions|disjunct and exclusive|overlapping, multiple mem.
Hierarchy|mono-hierarchic|poly-hierarchic
Markers|based on cultural markers |broad basis of material culture
...|* ECNR-System| * No cultural equation
...|* Ethnic Groups = historical identification| * Ethnic Groups are the results of social interaction
...|* Cultures = empirical foundation| * Cultures are the adaptation, caused by interaction
...|* Nations = significance for people| * Nations are the result of political interaction
...|*Races = modern science based on laws of nature| * ’Races’, or rather biological units are the result of biological interaction
Entaglement|ethnic group = seed of nation = race = culture|ethnic group ̸= seed of nation ̸= race ̸= culture

<div style='position:absolute;top:5%;right:5%'>
    <img  height="100" width="275" src='assets/img/pic11.png' />
</div>

--- 

## Cultural distances


<div style='position:absolute;bottom:30%;right:10%'>
    <img  height="300" src='assets/img/pic11.png' />
</div>

--- &twocol

## Cultural distances

*** =left

**'Typenspektren'**

- All data are used for the calculation of cultural distances
- No diagnostic types or cultural markers
- ’Typenspektren’ include the relative amount of objects of certain types.

<div style='position:absolute;bottom:15%;left:10%'>
    <img  height="200" width="450" src='assets/img/pic02.png' />
</div>

*** =right

<div style='position:absolute;bottom:20%;right:10%'>
    <img  height="450" width="300" src='assets/img/pic12.png' />
</div>

--- &twocol

## Cultural distances | 'Typenspektren' 

*** =left

**Cultural fingerprint**

- 'Typenspektren' are a kind of cultural fingerprints.
- 'Typenspektren' don’t assume spatial archaeological cultures.
- 'Typenspektren' consider quantities and not only presence/absence.
- for every type of 'Typenspektren' a group of types, representing a certain part of society can be defines.
- 'Typenspektren' provide much more information and are much more robust than so called 'cultural markers'.

*** =right

<div style='position:absolute;top:15%;right:15%'>
  <img  height="300" width="200" src='assets/img/pic13.png' />
</div>

<div style='position:absolute;bottom:10%;right:10%'>
  <img  height="200" width="350" src='assets/img/pic14.png' />
</div>

--- &twocol

## Cultural distances | 'Typenspektren' 

**'Typenspektren' - using all available information**

*** =left

- 2; ”Beil”; xxx
  - 22; ”Beil, Tüllenbeil”; xxx
  - 221; ”Beil, T, Schlichte vierkantige T”; xxx
  - 2211; ”Beil, T, Schlichte vierkantige T, Norddeutsche T, Var. Hesepe”; xxx


*** =right

- 4; ”Nadel”; xxx
  - 41; ”Nadel, Rippenkopfnadeln”; xxx
  - 411; ”Nadel, Rippenkopfnadeln, Var. Nutteln”; xxx
  - 412; ”Nadel, Rippenkopfnadeln, Var. Badenstedt”; xxx

<div style='position:absolute;bottom:5%;right:25%'>
  <img  height="200" width="450" src='assets/img/pic15.png' />
</div>

--- .segue bg:grey

## Which information can be used in 'Typenspektren'?

<a class="btn btn-primary btn-large" href='https://isaakiel.github.io/index.html'>
 <img  height="100" width="100" style='position:absolute;top:5%;right:5%' src='assets/img/ISAAK.png' />
</a>

---

## Cultural distances

**Map of cultural distances**
- the cultural distances to one reference point are mapped on a grid
- topography of cultural similarities
- structure of interaction space

<div style='position:absolute;bottom:15%;right:20%'>
  <img  height="200" width="550" src='assets/img/pic16.png' />
</div>

--- &twocol

## Cultural distances

*** =left

**Interaction spaces**

- groups of similar material culture indicate interaction spaces
- hierarchical Cluster analysis of regional Typensprektren
- cultural distance as Euclidean distance of two normalised Typensprektren

*** =right

<div style='position:absolute;bottom:10%;right:5%'>
  <img  height="600" width="500" src='assets/img/pic17.png' />
</div>

---

## Cultural distances | Methodology for cultural areas

**Interaction areas**

<div style='position:absolute;bottom:10%;right:15%'>
  <img  height="450" width="800" src='assets/img/pic18.png' />
</div>

--- &twocol

## Cultural distances

*** =left

**Hunsrück-Eifel-Kultur**
- same extent of different groups of material culture
- crisp border

<div style='position:absolute;bottom:20%;left:10%'>
  <img  height="250" width="300" src='assets/img/pic20.png' />
</div>


*** =right

**Baden-Württemberg**
- fuzzy borders
- overlapping cultural areas

<div style='position:absolute;bottom:15%;right:5%'>
  <img  height="300" width="550" src='assets/img/pic19.png' />
</div>

---

## Cultural distances | Methodology for cultural areas

**distance diagrams**

<div style='position:absolute;bottom:20%;right:15%'>
  <img  height="350" width="800" src='assets/img/pic21.png' />
</div>

--- .segue bg:grey

## But how?!

<a class="btn btn-primary btn-large" href='https://isaakiel.github.io/index.html'>
 <img  height="100" width="100" style='position:absolute;top:5%;right:5%' src='assets/img/ISAAK.png' />
</a>

---

## Preparation | Working Directory & Load Data

```{r collapse=TRUE, eval=FALSE}
wd <- ".//home/fon/daten/analyse/mosaic"
setwd(wd)
```

```{r collapse=TRUE}
df.weapons <- read.csv("2data/shkr-weapons.csv", header=TRUE, sep=";")
t <- as.character(df.weapons[,13])
df.weapons <- data.frame(id= df.weapons[,4], 
               x=df.weapons[,1], y=df.weapons[,2], 
               t, stringsAsFactors = FALSE)
```

---

## Exploring Data | Structure & Content

```{r collapse=TRUE}
str(df.weapons)
```

```{r collapse=TRUE}
df.weapons[1:4,]
```

--- &twocol

## Global 'Typenspektrum' 

*** =left

- counting finds per type
- considering type hierarchy

```{r echo=FALSE, fig.align='right', fig.height=6, fig.width=6 }
tab.weapons <- table(df.weapons[,4])
tw <- tab.weapons
for (i in seq_along(tab.weapons)) {
  a <- dimnames(tab.weapons)[[1]][i]
  b <- dimnames(tab.weapons)[[1]][]
  tw[i] <- sum(tab.weapons[grepl(a, b)])
}
barplot(tw)
```

*** =right

```{r collapse=TRUE, fig.show='hide', eval=FALSE}
tab.weapons <- table(df.weapons[,4])
tw <- tab.weapons
for (i in seq_along(tab.weapons)) {
  a <- dimnames(tab.weapons)[[1]][i]
  b <- dimnames(tab.weapons)[[1]][]
  tw[i] <- sum(tab.weapons[grepl(a, b)])
}
barplot(tw)
```

--- &twocol

## Spatial Data

*** =left

- packages
- projection data
- conversion

*** =right

```{r collapse=TRUE, results='hide'}
library(sp)         # spatial objects
library(proj4)      # projection
library(spatstat)   # spatial statistics
library(maptools)   # spatial tools

crs1 <- "+proj=tmerc +lat_0=0 +lon_0=9
+k=1 +x_0=3500000 +y_0=0
+ellps=WGS84 +units=m +no_defs"

coordinates(df.weapons)=~x+y
proj4string(df.weapons) <-
CRS(as.character(crs1))
```

---

## What is inside? | Structure of Spatial Objects

```{r collapse=TRUE}
str(df.weapons)
```

--- &twocol

## Prep. local 'Typenspektren'

*** =left

- list of types
- variables
- owin object (`spatstat`)
- regular sample points

*** =right

```{r collapse=TRUE}
type.list <- unlist(dimnames(tab.weapons))
type.n <- length(type.list)
sdev <- 5000
bb <- bbox(df.weapons)
win <- owin(xrange=c(bb[1,1],bb[1,2]),
yrange= c(bb[2,1],bb[2,2]),
  unitname="m")
s.points <- spsample(df.weapons, 100,
  type="regular")
samp <- list()
i=0
```

--- &twocol

## Loop local 'Typenspektren'

*** =left

- loop through all types
- producing a point pattern object
- calculating density
- sampling density
- Typenspektren as list of vectors

*** =right

```{r collapse=TRUE, warning=FALSE}
for (t in type.list) {
  i <- i+1
  finds <- df.weapons[which(df.weapons
                            @data$t==t),]
  ppp_w <- ppp(finds@coords[,1],
      finds@coords[,2], window=win)
  dens <- density(ppp_w, kernel="gaussian", 
      sigma=sdev, dimyx=c(36,56), w=win,
      edge=TRUE, at="pixels")
  sgdf_w_dens <- as.SpatialGridDataFrame.im(
      dens)
  proj4string(sgdf_w_dens) <- CRS(
      as.character(crs1))
  meg_dens_samp <- over(s.points, 
                        sgdf_w_dens)
  samp[[i]] <- meg_dens_samp
}
```

--- 

## Exploring the result | Structure & Content

```{r}
str(samp)
```

--- 

## Exploring the result | Structure & Content


```{r}
samp
```

--- &twocol

## Conversion to Data Frame

*** =left

- points in rows
- types in columns
- rename columns

*** =right

```{r collapse=TRUE, warning=FALSE}
ts <- data.frame(matrix(unlist(samp),
      nrow=49, byrow=T))
colnames(ts) <- type.list
ts[1:4,1:3]
```

--- &twocol

## Distance diagram (dd)

*** =left

- different view-points
- different focus-points
- cultural distance as an inverse interaction proxy

<div style='position:absolute;bottom:20%;left:10%'>
  <img  height="250" width="350" src='assets/img/pic23.png' />
</div>


*** =right

Viewpoint|fixed vocus|selected focus|all foucused
----|----|----|----
fixed viewpoint|**dd1** fixed profile dd, similarity profiles|**dd2** fixed sector dd|**dd3** fixed multi-focal dd, fall-off curve
selected viewpoints|**dd4** selected profile dd|**dd5** selected secotr dd|**dd6** selected multi-focal dd
all viewpoints**dd7** aggregated profile dd|**dd8** aggregated sector dd|**dd9** aggregated multi-focal dd, variogram
  

---

## Cultural Distances 

<div style='position:absolute;bottom:10%;right:15%'>
  <img  height="500" width="750" src='assets/img/pic24.png' />
</div>

--- .segue bg:grey

## Do you have other ideas for interpretation?

<a class="btn btn-primary btn-large" href='https://isaakiel.github.io/index.html'>
 <img  height="100" width="100" style='position:absolute;top:5%;right:5%' src='assets/img/ISAAK.png' />
</a>

---

## Space 

**Disciplinary spaces**

A metrical space is spanned by a metric, which defines
distances.
- A **social space** is constructed by social distances.
- An **economic space** is constructed by economic distances.
- A **cultural space** is constructed by cultural distances.
- A **geographic space** is constructed by geodetic distances.

--- &twocol

## Interaction model

*** =left

- fixed starting point
- fixed profile
- ceramics
- interaction friction at Black Forrest?

<div style='position:absolute;bottom:10%;left:10%'>
  <img  height="300" width="250" src='assets/img/pic26.png' />
</div>


*** =right

<div style='position:absolute;bottom:20%;right:5%'>
  <img  height="350" width="550" src='assets/img/pic25.png' />
</div>

--- &twocol

## Interaction model

*** =left

- fixed starting point
- along the main axes
- ceramics
- rivers as interactive areas?

<div style='position:absolute;bottom:10%;left:10%'>
  <img  height="300" width="250" src='assets/img/pic28.png' />
</div>


*** =right

<div style='position:absolute;bottom:20%;right:5%'>
  <img  height="350" width="550" src='assets/img/pic27.png' />
</div>

--- &twocol

## Interaction model

*** =left

- from all points
- to all points
- fibulae and adornment
- interaction threshold at 200 km?


*** =right

<div style='position:absolute;bottom:20%;right:5%'>
  <img  height="350" width="550" src='assets/img/pic29.png' />
</div>

---

## Theoretical Models

**Interaction decreases with distance.**
Distance decay functions can quantify the decrease.

<div style='position:absolute;bottom:10%;left:5%'>
  <p><b>Tobler’s first law of geography</b></p>
  <p>Everything is related to everything else, but near things are more related </p>
  <p>than distant things.</p>
</div>

<div style='position:absolute;bottom:33%;right:5%'>
  <img  height="300" width="450" src='assets/img/pic24.png' />
</div>

<div style='position:absolute;bottom:35%;left:5%'>
  <img  height="250" width="500" src='assets/img/pic30.png' />
</div>

--- &twocol

## Gravity models

*** =left

- involve properties of the interaction partners
- based on an analogy from physics
- population, settlement size, …
- can be used to produce distance decay functions/fall off curves, which consider population

*** =right

<div style='position:absolute;bottom:25%;right:5%'>
  <img  height="300" width="450" src='assets/img/pic31.png' />
</div>

--- &twocol

## Distance diagram (dd)

*** =left

- different viewpoints
- different focus-points
- cultural distance as an inverse interaction proxy

*** =right

Viewpoint|fixed vocus|selected focus|all foucused
----|----|----|----
fixed viewpoint|**dd1** fixed profile dd, similarity profiles|**dd2** fixed sector dd|**dd3** fixed multi-focal dd, fall-off curve
selected viewpoints|**dd4** selected profile dd|**dd5** selected secotr dd|**dd6** selected multi-focal dd
all viewpoints**dd7** aggregated profile dd|**dd8** aggregated sector dd|**dd9** aggregated multi-focal dd, variogram

--- &twocol

## Mapping profiles

*** =left 

```{r collapse=TRUE,  fig.show='hide'}
p.index <- (s.points@coords[,1] > 3475200 & s.points@coords[,1] < 3511200)
p.points <- s.points[p.index,]
p.ts <- ts[p.index,]

plot(s.points)
points(df.weapons, col='grey')
points(p.points, pch=16, col="dark red")
```

*** =right

```{r echo=FALSE,  fig.align='right', fig.height=6, fig.width=6 }
plot(s.points)
points(df.weapons, col='grey')
points(p.points, pch=16, col="dark red")
```

--- &twocol

## dd1

*** =left

- distance function
- data for specific distance diagram
- distance calculation
- plot

<div style='position:absolute;bottom:15%;left:10%'>
  <img  height="250" width="300" src='assets/img/pic33.png' />
</div>

*** =right

```{r collapse=TRUE, fig.show='hide', eval=FALSE}
edist <- function(a,b){sqrt(sum((a-b)^2))}
n <-length(p.points@coords[,1])
x <-1:n
df.d <- data.frame(p1=rep(1,n),p2=x,
  d1=x,d2=x)
for (i in seq_along(p.ts[,1])) {
  df.d[i,3] <- edist(p.points@coords[1,],
  p.points@coords[i,])
}
for (i in seq_along(p.ts[,1])) {
  df.d[i,4] <- edist(p.ts[1,],p.ts[i,])
}
plot(df.d[,3:4], pch=16, xlab="spatial
  distance (km)", ylab= "density
  distance", main="dd1")
lines(df.d[,3:4])
```

--- &twocol

## dd3

*** =left

- similar to dd1
- sampling cultural distances in spatial distance ranges

<div style='position:absolute;bottom:15%;left:10%'>
  <img  height="250" src='assets/img/pic34.png' />
</div>

*** =right

```{r collapse=TRUE, fi.show='hide', eval=FALSE}
p.points <- s.points; p.ts <- ts
n <-length(p.points@coords[,1]); x <-1:n
df.d<-data.frame(p1=rep(1,n),p2=x,d1=x,d2=x)
for (i in seq_along(p.ts[,1])) {
  df.d[i,3] <- edist(p.points@coords[50,],
  p.points@coords[i,])}
for (i in seq_along(p.ts[,1])) {
  df.d[i,4] <- edist(p.ts[50,],p.ts[i,])}
  df.dd <- data.frame(id=seq(0,250000,20000)
  /20000+1,d1=seq(0,250000,20000),
  d2=seq(0,250000,20000))
for (i in df.dd[,1]) {
  df.dd[i,3] <- mean(df.d[(df.d[,3] >
  df.dd[i,2] & df.d[,3] < df.dd[i+1,2]),4])}
plot(df.dd[,2:3], pch=16, xlab="spatial distance (m)", 
  ylab= "density distance", main="dd3")
lines(df.dd[,2:3])
```

--- &twocol

## dd9

*** =left

- similar to dd1
- sampling cultural distances in spatial distance ranges


*** =right

```{r collapse=TRUE, fi.show='hide', eval=FALSE}
p.points <- s.points; p.ts <- ts
n <-length(p.points@coords[,1]); x <-1:n
df.d <- data.frame(p1=rep(1,n),p2=x,d1=x,d2=x)
for (i in 2:n) {
  df.d <- rbind(df.d,data.frame(p1=rep
  (i,n),p2=x,d1=x,d2=x))}
for (i in seq_along(df.d[,1])) {
  df.d[i,3] <- edist(p.points@coords[
  df.d[i,1],],p.points@coords[df.d[i,2],])}
for (i in seq_along(df.d[,1])) {
  df.d[i,4] <- edist(p.ts[df.d[i,1],],
  p.ts[df.d[i,2],])}
df.dd <- data.frame(id=seq(0,250000,20000)
  /20000+1,d1=seq(0,250000,20000),
  d2=seq(0,250000,20000))
for (i in df.dd[,1]) {
  df.dd[i,3] <- mean(df.d[(df.d[,3] >
  df.dd[i,2] & df.d[,3] < df.dd[i+1,2]),4])}
```

--- &twocol

## dd9

*** =left

- similar to dd1
- sampling cultural distances in spatial distance ranges

<div style='position:absolute;bottom:15%;left:15%'>
  <img  height="300" src='assets/img/pic35.png' />
</div>


*** =right

```{r collapse=TRUE, fi.show='hide', eval=FALSE}
plot(df.dd[,2:3], pch=16, xlab="spatial distance
  (m)", ylab= "density distance", main="dd9")
lines(df.dd[,2:3])
```


--- 

## How can we interpret the distance diagrams?
## Which pitfalls for interpretation can you find?
## How can we improve the distance diagrams and develop other versions?

<a class="btn btn-primary btn-large" href='https://isaakiel.github.io/index.html'>
 <img  height="100" width="100" style='position:absolute;top:5%;right:5%' src='assets/img/ISAAK.png' />
</a>
    

--- .segue bg:grey

## Apply distance diagrams in the workshop this afternoon!

<a class="btn btn-primary btn-large" href='https://isaakiel.github.io/index.html'>
 <img  height="100" width="100" style='position:absolute;top:5%;right:5%' src='assets/img/ISAAK.png' />
</a>

--- .segue bg:grey

## Cultural & Geographic Distance

<a class="btn btn-primary btn-large" href='https://isaakiel.github.io/index.html'>
 <img  height="100" width="100" style='position:absolute;top:5%;right:5%' src='assets/img/ISAAK.png' />
</a>

--- &twocol

## Distance analyses in geographic space

*** =left

- abstract concept: can be measured in meters, time, money, strangeness, ...
- influence interactions


*** =right

<div style='text-align: center;'>
    <img height='460' src='assets/img/pic_daniel_Harris_Ullman_1945_p8.png' />
</div>

---

## Distance analyses in geographic space

1. straight/ direct

- Euclidean distance
- "As the crow flies"
- "In a beeline"
- geodesic distance
- great-circle distance

2. not direct/ random
    
- random walk
- "Drunkard's Walk"

--- &twocol

## Distance analyses in geographic space

Two concepts with different premises

*** =left

1. straight/ direct

- Euclidean distance
- "As the crow flies"
- "In a beeline"
- geodesic distance
- great-circle distance
- least-cost distance

*** =right

2. not direct/ random
    
- random walk
- "Drunkard's Walk"

--- &twocol

## Distance analyses in geographic space

A reminder about spatial data. 

```{r echo=FALSE, message=FALSE, results="hide"}
library(rgdal)
dem <- readGDAL("./3geodata/dw_gk3_50_ag.asc")
```

*** =left

What is the meaning of the coordinates?

```{r}
dem@bbox
```

What is the Spatial Reference System (SRS)?

[= Coordinate Reference System (CRS)]


*** =right

<div style='text-align: center;'>
    <img height='460' src='https://upload.wikimedia.org/wikipedia/commons/1/15/MercTranSph.png' />
</div>

<div style="font-size:10px">By <a href="//commons.wikimedia.org/wiki/User:Peter_Mercator" title="User:Peter Mercator">Peter Mercator</a> - <span class="int-own-work" lang="en">Own work</span>, Public Domain, https://commons.wikimedia.org/w/index.php?curid=9910926</div>


--- &twocol

## Distance analyses in geographic space

A reminder about spatial data. 

```{r echo=FALSE, message=FALSE, results="hide"}
library(rgdal)
dem <- readGDAL("./3geodata/dw_gk3_50_ag.asc")
```

*** =left

What is the meaning of the coordinates?

```{r}
dem@bbox
```

What is the Spatial Reference System (SRS)?

[= Coordinate Reference System (CRS)]


*** =right

<div style='text-align: center;'>
    <img height='520' src='https://upload.wikimedia.org/wikipedia/de/1/12/Gau%C3%9F-Kr%C3%BCger-Raster_Deutschland.png' />
</div>

<div style="font-size:10px">Von <a href="//de.wikipedia.org/wiki/Benutzer:BerndH" title="Benutzer:BerndH">BerndH</a> - selbst erstellt mit Generic Mapping Tools (psbasemap, psxy), Python, GIMP, <a title="Creative Commons Namensnennung-Weitergabe unter gleichen Bedingungen Unported 3.0" href="http://creativecommons.org/licenses/by-sa/3.0/legalcode">CC BY-SA 3.0</a>, https://de.wikipedia.org/w/index.php?curid=4186798</div>


--- &twocol

## Distance analyses in geographic space

*** =left

https://epsg.io/5677

```{r fig.show='hide'}
dem@proj4string
dem@proj4string <- CRS("+init=epsg:5677")
## dem@proj4string
is.projected(dem)
```

*** =right

```{r echo=FALSE}
library(raster)
plot(raster(dem))
```

---

## Distance analyses in geographic space

From a list of points to a spatial object [a reminder]

```{r}
download.file(
    url = "https://raw.githubusercontent.com/dakni/mhbil/master/data/meg_dw.csv",
    destfile = "2data/meg_dw.csv")

meg_dw <- read.table(file = "2data/meg_dw.csv",
                     header = TRUE,
                     sep = ";")
head(meg_dw)
```

---

## Distance analyses in geographic space

Create SpatialPointsDataFrame (spdf)

```{r}
library(sp)
coordinates(meg_dw) <- ~x+y
str(meg_dw)
```

--- &twocol


## Distance analyses in geographic space

Project `spdf` and plot

*** =left

```{r fig.show="hide"}
is.projected(meg_dw)
proj4string(meg_dw) <- CRS("+init=epsg:5677")
is.projected(meg_dw)
plot(raster(dem)); points(meg_dw)     
```

*** =right

```{r echo=FALSE}
plot(raster(dem)); points(meg_dw)
```

---

## Distance analyses in geographic space

$$d(i,j) = \sqrt{(x_i-x_j)^2 + (y_i-y_j)^2}$$

--- &twocol

## Distance analyses in geographic space

*** =left

Distance between points using Euclidean distance using package `rgeos`

```{r fig.show="hide"}
library(rgeos)
ed <- gDistance(spgeom1 = meg_dw,
                byid = TRUE)
## class(ed)
## str(ed)
library(fields)
image.plot(ed)
```

*** =right

```{r echo=FALSE}
image.plot(ed)
```

--- 

## Distance analyses in geographic space

```{r}
min(ed)
```

```{r}
round(data.frame(min = min(ed[ed>0]),
                 max = max(ed[ed>0]),
                 mean = mean(ed[ed>0]),
                 median = median(ed[ed>0])
                 ),
      2)
```


--- &twocol

## Distance analyses in geographic space

*** =left

```{r fig.show="hide"}
hist(ed)
abline(v = mean(ed[ed>0]), col = "red")
abline(v = median(ed[ed>0]), col = "blue")
```

*** =right

```{r echo=FALSE}
hist(ed)
abline(v = mean(ed[ed>0]), col = "red")
abline(v = median(ed[ed>0]), col = "blue")
```

--- &twocol

## Distance analyses in geographic space

Some further questions that might be interesting

*** =left

```{r fig.show="hide"}
mp <- apply(X = ed,
            MARGIN = 2,
            FUN = mean)

tmp <- ed
tmp[tmp==0] <- 9999

cp <- apply(X = tmp,
            MARGIN = 2,
            FUN = min)

meg_dw$mp <- mp
meg_dw@data$cp <- cp
```

*** =right

What is the mean euclidean distance from a point to its surrounding points (mp)?

What is the closest euclidean distance from a point to its surrounding points (cp)?

**Question:** Why changing 0 to 9999?

--- &twocol

## Distance analyses in geographic space

Examples how to use `spplot`: http://rspatial.r-forge.r-project.org/gallery/

*** =left

```{r out.width="450px"}
spplot(meg_dw, "cp")
```

*** =right

```{r out.width="450px"}
spplot(meg_dw, "mp")
```

---

## Distance analyses in geographic space

Leaflet in `R`: https://rstudio.github.io/leaflet/

```{r eval=FALSE}
library(leaflet)
tmp <- spTransform(meg_dw, CRSobj = CRS("+init=epsg:4326"))
leaflet(data=tmp$cp) %>%
    addTiles() %>%
    addCircleMarkers(lng = tmp@coords[,1],
                     lat = tmp@coords[,2],
                     radius = tmp$mp/1000,
                     )
```

---

## Distance analyses in geographic space

`Mapview` [as alternative to `leaflet`]: http://environmentalinformatics-marburg.github.io/mapview/introduction.html

```{r eval=FALSE}
library(mapview)
mapview(meg_dw, zcol = "mp", legend = TRUE)
```

---

## Distance analyses in geographic space

**Least-cost distances**

- Cost is --- like distance --- an abstract concept; hence, YOU decide what your costs are (time, energy, ugliness, ...)
- Least-cost distance analyses allow to integrate prior knowledge and more complexity into your model.

---

## Distance analyses in geographic space

**Least-cost distances**

- Cost is --- like distance --- an abstract concept; hence, YOU decide what your costs are (time, energy, ugliness, ...)
- Least-cost distance analyses allow to integrate prior knowledge and more complexity into your model.

**There was a discourse at the LAC about least-cost paths (LCP):**
- Opinion 1: LCP follow a **capitalistic** ideology since their aim is the best optimization. They are blind for post-processual ideas
- Opinion 2: LCP do optimize a certain path. But the rules, how they do it, is defined by **parameters** chosen for the model. Hence, they are able to grasp post-processual ideas

---

## Distance analyses in geographic space

Basic work about least-cost distances and path analyses (usefulness, applicability, problems,...) was/is conducted quite excessively by Irmela Herzog (https://bodendenkmalpflege-lvr.academia.edu/IrmelaHerzog)

--- &twocol

## Distance analyses in geographic space

What does it mean?

*** =left

```{r}
## km/h
tobler1993a <- function(s){
    6 * exp(-3.5 * abs(s + 0.05))
}
## m/min
tobler1993b <- function(s){
    0.36 * exp(-3.5 * abs(s + 0.05))
}   
```

*** =right

```{r echo=FALSE}
plot(tobler1993a,
     xlim = c(-1,1),
     main = "Slope-dependent cost function (Tobler)",
     xaxt="n",yaxt="n",
     xlab = "",ylab = "")

mtext(side = 1, text = "slope", line = 2)
mtext(side = 2, text = "speed (km/h)", line = 2)

axis(2, mgp=c(3, .5, 0))
axis(1, mgp=c(3, .5, 0))

abline(v = 0, lty = 2)
```

--- &twocol

## Distance analyses in geographic space

Technically speaking, there are two different ways how least-cost paths are created

*** =left

1. create a cost raster
2. accumulate the costs from one of your points of interest
3. "walk" from a target point along the accumulated raster to your starting point (like water flows into a sink)

In `GrassGIS`:

- cost raster
- `r.cost`/`r.walk`
- `r.drain`

*** =right

--- &twocol

## Distance analyses in geographic space

Technically speaking, there are two different ways how least-cost paths are created

*** =left

1. create a cost raster
2. accumulate the costs from one of your points of interest
3. "walk" from a target point along the accumulated raster to your starting point (like water flows into a sink)

In `GrassGIS`:

- cost raster
- `r.cost`/`r.walk`
- `r.drain`

*** =right

1. create cost raster
2. create matrix of cell connections
3. find "cheapest" path between points along cell connections

`gdistance` in `R` a package by Jacob van Etten (https://cran.r-project.org/web/packages/gdistance)

---

## Distance analyses in geographic space

What are the necessary steps?

1. Create cost surface

<div style='text-align: center;'>
	<img height='360' src='assets/img/pic_daniel_transition_raster.png' />
</div>

<div style='text-align: right; font-size:12px'>
https://cran.r-project.org/web/packages/gdistance/vignettes/gdistance1.pdf
</div>

---

## Distance analyses in geographic space

What are the necessary steps?

1. Create cost surface
2. Create transition matrix, i.e. matrix recording connections between cells

<div style='text-align: center;'>
	<img height='360' src='assets/img/pic_daniel_transition.png' />
</div>

<div style='text-align: right; font-size:12px'>
https://cran.r-project.org/web/packages/gdistance/vignettes/gdistance1.pdf
</div>

---

## Distance analyses in geographic space

What are the necessary steps?

1. Create cost surface
2. Create transition matrix, i.e. matrix recording connections between cells
3. Transition matrix is filled with conductance, rather than resistance values; hence unconnected cells have value 0 (= no conductance); memory efficient

---

## Distance analyses in geographic space

What are the necessary steps?

1. Create cost surface
2. Create transition matrix, i.e. matrix recording connections between cells
3. Transition matrix is filled with conductance, rather than resistance values; hence unconnected cells have value 0 (= no conductance); memory efficient
4. Geocorrection of values

<a class="btn btn-primary btn-large" href='http://image.slidesharecdn.com/maths-quadrilateral-150915085844-lva1-app6891/95/maths-quadrilateral-15-638.jpg?cb=1442307682'>
<div style='text-align: center;'>
<img height='360' src='http://image.slidesharecdn.com/maths-quadrilateral-150915085844-lva1-app6891/95/maths-quadrilateral-15-638.jpg?cb=1442307682' />
</div>
</a>

---

## Distance analyses in geographic space

What are the necessary steps?

1. Create cost surface
2. Create transition matrix, i.e. matrix recording connections between cells
3. Transition matrix is filled with conductance, rather than resistance values; hence unconnected cells have value 0 (= no conductance); memory efficient
4. Geocorrection of values
5. Identify adjacent cells

---

## Distance analyses in geographic space

What are the necessary steps?

1. Create cost surface
2. Create transition matrix, i.e. matrix recording connections between cells
3. Transition matrix is filled with conductance, rather than resistance values; hence unconnected cells have value 0 (= no conductance); memory efficient
4. Geocorrection of values
5. Identify adjacent cells
6. Calculate walking speed for adjacent cells

---

## Distance analyses in geographic space

What are the necessary steps?

1. Create cost surface
2. Create transition matrix, i.e. matrix recording connections between cells
3. Transition matrix is filled with conductance, rather than resistance values; hence unconnected cells have value 0 (= no conductance); memory efficient
4. Geocorrection of values
5. Identify adjacent cells
6. Calculate walking speed for adjacent cells
7. Geocorrect speed values

---

## Distance analyses in geographic space

What are the necessary steps?

1. Create cost surface
2. Create transition matrix, i.e. matrix recording connections between cells
3. Transition matrix is filled with conductance, rather than resistance values; hence unconnected cells have value 0 (= no conductance); memory efficient
4. Geocorrection of values
5. Identify adjacent cells
6. Calculate walking speed for adjacent cells
7. Geocorrect speed values
8. Find path using least-cost ("as the wolf runs") or random walk ("drunkard's walk") algorithm

--- &twocol

## Distance analyses in geographic space

*** =left

First we calculate the slope, as this is used as cost

```{r message=FALSE, fig.show="hide"}
library(raster)
dem <- raster(dem)
slope <- terrain(x = dem,
                 opt = "slope",
                 neighbors = 8,
                 unit = "degrees")
##drawExtent()
crop.extent <- extent(
    c(3551000,3578650,6022770,6045000))
slope <- crop(x = slope, y = crop.extent)
```

*** =right

```{r echo=FALSE}
plot(slope)
```

--- &twocol

## Distance analyses in geographic space

*** =left

We need to get rid of the ocean areas since it is not crossable (by foot)

- get land areas
- reproject them
- mask the slope
- reproject and factorize
- create uncrossable transition area


*** =right

```{r echo=FALSE, message=FALSE, results="hide"}
ab <- rgdal::readOGR("3geodata", layer = "GADM_DE")
```

```{r eval=FALSE}
ab <- getData('GADM', country = 'DEU', level = 1)
```

```{r}
ab <- spTransform(ab, CRSobj = CRS("+init=epsg:5677"))
slope <- mask(slope, mask = ab, updatevalue = 9999)
```

---

## Distance analyses in geographic space

Afterwards we create the transition object and geocorrect it

```{r message=FALSE}
library(gdistance)
slope.tran <- transition(x = slope,
                         transitionFunction = mean,
                         directions = 8,
                         symm = TRUE)

slope.geo <- geoCorrection(x = slope.tran, scl = TRUE)
```

To see how the results look like we create a raster stack for easy plotting

```{r message=FALSE, fig.show = "hide"}
slopes <- stack(slope,
                raster(slope.tran),
                raster(slope.geo))
names(slopes) <- c("Slope","Transition","Geocorrection")
plot(slopes, nr = 1)
```

--- &twocol

## Distance analyses in geographic space

Now, the final step. Calculate Tobler's hiking speed, geocorrect again and calculate a shortest path

*** =left

```{r message=FALSE, fig.show = "hide"}
adj <- adjacent(x = slope,
                cells=1:ncell(slope),
                pairs=TRUE,
                directions=8)
speed <- slope.geo
speed[adj] <-  6 * exp(-3.5 * abs(slope.geo[adj] + 0.05))

speed.geo <- geoCorrection(x = speed, scl=TRUE)

sp1 <- shortestPath(x = speed.geo,
                    origin = meg_dw@coords[4,],
                    goal = meg_dw@coords[231,],
                    output = "SpatialLines")

plot(raster(speed.geo))
lines(sp1)
```

*** =right

```{r echo=FALSE}
plot(raster(speed))
lines(sp1)
```

---

## Distance analyses in geographic space

What about the "drunkard's walk"? `theta` is the level of drunkenness, i.e. the degree from which
the path randomly deviates from the shortest path

```{r message=FALSE, fig.show = "hide"}
p1 <- passage(x = speed.geo,
              origin = meg_dw@coords[4,],
              goal = meg_dw@coords[231,],
              theta = .005)              
              
p2 <- passage(x = speed.geo,
              origin = meg_dw@coords[4,],
              goal = meg_dw@coords[231,],
              theta = .05)

hs <-  hillShade(slope = terrain(x = dem*10, opt = "slope"),
                 aspect = terrain(x = dem, opt = "aspect"),
                 angle = 40, direction = 270)

plot(hs, col=grey(0:100/100), legend=FALSE)
plot(p1, alpha = .5, add=TRUE); lines(sp1)
```


--- &twocol

## Distance analyses in geographic space

*** =left

theta = .005

```{r echo=FALSE}
plot(hs, col=grey(0:100/100), legend=FALSE)
plot(p1, alpha = .5, add=TRUE)
lines(sp1)
```

*** =right

theta = .05

```{r echo=FALSE}
plot(hs, col=grey(0:100/100), legend=FALSE)
plot(p2, alpha = .5, add=TRUE)
lines(sp1)
```

---

## Distance analyses in geographic space

What about the idea of a **prehistoric autobahn**? Run the code and get some coffee... a lot of coffee

```{r message=FALSE, results="hide", fig.show="hide", eval=FALSE}
xy <- data.frame(X = meg_dw@coords[,1],
                 Y = meg_dw@coords[,2])

rows.xy <- row.names(xy)
sa.rows.xy <- sample(row.names(xy), length(xy$X)/2)
starts <- subset(xy, rows.xy %in% sa.rows.xy)
goals <- subset(xy, !(rows.xy %in% sa.rows.xy))
sg.passages <- brick(slope)

for(i in 1:length(starts$X)) {
    s <- c(starts$X[i],starts$Y[i])
    z <- c(goals$X[i],goals$Y[i])
    sg.passages[[i]] <- passage(x = speed.geo, origin = s, goal = z, theta = .05) 
    cat("iteration ", i, " of ", length(starts$X),"\n")
}

sg.passages.sum <- sum(sg.passages)
```

---

## Distance analyses in geographic space

```{r echo=FALSE, eval=FALSE}
plot(hs, col=grey(0:100/100), legend=FALSE)
plot(sg.passages.sum,
     col = colorRampPalette(colors = c("white","red"))(50),
     alpha = .8,
     add=TRUE)
points(meg_dw,
       pch = 19,
       col = rgb(red = 0, green = 0, blue = 0, alpha = .2))
```

--- 

## Distance analyses in geographic space

<div style='text-align: center;'>
<img height='560' src='assets/img/pic_daniel_autobahn.png' />
</div>


---

<a class="btn btn-primary btn-large" href='https://isaakiel.github.io/index.html'>
  <img  height="300" width="300" style='position:absolute;top:20%;right:35%' src='assets/img/ISAAK.png' />
</a>
